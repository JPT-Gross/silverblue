<!DOCTYPE html>
<html>
<head>
<title>JPT Schedule</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<script>
    const dayColor = 
    ["<b>A</b><br>Day", "<b>B</b><br>Day", "<b>A/B</b><br> Day", "Exam<br>Day", 
    "Day Off", "Thanksgiving", "Weekend", "Winter Break", "Spring Break"];
    const classPeriodA = 
        ["Good<br>Morning","1st<br>Period", "2nd<br>Period", "3rd<br>Period", 
        "4th<br>Period", "Good<br>Bye", "Study<br>Hall"];
    const classPeriodB = 
        ["Good<br>Morning", "5th<br>Period", "6th<br>Period", "7th<br>Period", 
        "8th<br>Period", "Good<br>Bye", "Study<br>Hall"];
    var currentPeriod = 0;
    const lunch = ["A Lunch", "B Lunch"];
    const earlyRelease = [62, 145, 180, 211, 239, 295];
    const earlyReleaseBell = [0, 460, 528, 602, 676, 750];
    const PSD = [15, 50, 78, 106, 141, 169, 197, 232];
    const PSDBell = [0, 460, 520, 586, 652, 718];
    const testing = [56];
    const testingBell = [0, 460, 475, 715, 790, 835, 880];
    const testingSchedule = [0, 1, 6, 3, 2, 4, 5];
    const examReverse = [120, 121];
    const examReverseSchedule = [0, 4, 3, 2, 1, 5];
    const bell = [0, 460, 558, 655, 783, 880];
    // This is an array of the school year where calendar[0] is the first day of
    // school (8-18-21).
    const calendar = 
        [2,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,4,4,0,1,0,6,6,1,0,1,4,0,6,6,1,0,
        1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,4,1,0,6,6,1,0,1,
        0,1,6,6,0,1,0,1,0,6,6,1,0,1,4,0,6,6,1,0,1,0,1,6,6,5,5,5,5,5,6,6,0,1,0,1,
        0,6,6,1,0,1,0,1,6,6,0,0,1,0,1,6,6,7,7,7,7,7,7,7,7,7,7,7,7,6,6,1,0,1,0,1,
        6,6,0,4,1,0,1,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,
        6,1,0,1,0,1,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,4,6,6,
        8,8,8,8,8,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,4,6,6,1,0,1,0,1,6,6,0,
        1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,4,1,
        0,1,0,6,6,3,3,3,3];

    function updateHTML(elmId, value) {
        var elem = document.getElementById(elmId);
        if(typeof elem !== 'undefined' && elem !== null) {
        elem.innerHTML = value;
        }
    }

    var updatePage = function() {
    //Get current day
    var today = new Date();

    //Get the current minutes since midnight
    var minsToday = ((today.getMinutes()) + (today.getHours()) * 60);

    //Days since the first day of school
    var date1 = new Date("08/18/2021");
    var date2 = today;

    //Calculate the time difference of the two dates
    var differenceInTime = date2.getTime() - date1.getTime();
    
    // Calculate the no. of days between two dates
    var differenceInDays = Math.trunc(differenceInTime / (1000 * 3600 * 24));

    var aOrB = differenceInDays;

    //Display current day

    if (calendar[aOrB] < 2){
        updateHTML("day", dayColor[calendar[aOrB]]);
    }
    
    //Is it a special day?
    var isEarlyRelease = false;
    var isPSD = false;
    var isTesting = false;
    var isExamReverse = false;
    
    for (let i = 0; i < earlyRelease.length; i++){
        if (earlyRelease[i] == aOrB){
            isEarlyRelease = true;
        }
    };

    for (let i = 0; i < PSD.length; i++){
        if (PSD[i] == aOrB){
            isPSD = true;
        }
    };

    for (let i = 0; i < testing.length; i++){
        if (testing[i] == aOrB){
            isTesting = true;
        }
    };

    for (let i = 0; i < examReverse.length; i++){
        if (examReverse[i] == aOrB){
            isExamReverse = true;
        }
    };

    //Bell schedule (in minutes since midnight)
    if (isEarlyRelease){
        for (let i = 0; i < earlyReleaseBell.length; i++){
            if (minsToday >= earlyReleaseBell[i])  {
                currentPeriod = i;
            }
        }
    } else if (isPSD){
        for (let i = 0; i < PSDBell.length; i++){
            if (minsToday >= PSDBell[i])  {
                currentPeriod = i;
            }
        }
    } else if (isTesting){
        for (let i = 0; i < testingBell.length; i++){
            if (minsToday >= testingBell[i])  {
                currentPeriod = testingSchedule[i];
            }
        }
    } else if (isExamReverse) {
        for (let i = 0; i < bell.length; i++){
            if (minsToday >= bell[i]) {
                currentPeriod = examReverseSchedule[i];
            }
        }
    }
    else {
        for (let i = 0; i < bell.length; i++){
            if (minsToday >= bell[i]) {
                currentPeriod = i;
            }
        }
    }

    //Change periods for A or B day
    if (calendar[aOrB] < 1) {
        updateHTML("period", classPeriodA[currentPeriod]);
    } else if (calendar[aOrB] < 2) {
        updateHTML("period", classPeriodB[currentPeriod]);
    } else {
        //Replace content with "No School" message
        var content = dayColor[calendar[aOrB]];
        document.getElementsByTagName('style')[0].innerHTML = 
            "body {font-family: Arial, Helvetica, sans-serif; color: #f1f1f1; font-size: 80px; background-color: #1e1e1e; text-align: center; position: absolute; top: 50%; left: 50%; -ms-transform: translate(-50%, -50%); transform: translate(-50%, -50%);}";
        document.getElementsByTagName('body')[0].innerHTML = 
            "Enjoy Your " + content;
    }

updateHTML("debug", today);
    };


    window.setInterval(updatePage, 10);
</script>

<style>
* {
    box-sizing: border-box;
}

body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: #26457a;
}

/* Style the header */
.header {
    color: #f1f1f1;
    padding: 15px;
    text-align: center;
    font-size: 35px;
}

/* Create three equal columns that floats next to each other */
.column {
    float: left;
    width: 50%;
    padding: 10px;
    font-size: 45px;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}

/* Style the footer */
.footer {
    background-color: #f1f1f1;
    padding: 10px;
    text-align: center;
}

.content {
    text-align: center;
    font-size: 90px;
    width: 300px;
    margin: auto;        
}

/* Responsive layout - makes the two columns stack on top of each other
instead of next to each other */
@media (max-width: 600px) {
    .column {
    width: 100%;
    }
}
</style>
</head>
<body>

<div class="header">
    <h2><img src="images/trojan.png" alt="Trojan logo" height="60"> Welcome to 
        Taravella!</h2>
</div>

<div class="row">
    <div class="column" style="background-color:#aaa;">Today is a(n)
        <div class="content">
            <p id=day></p>
        </div>
    </div>
    <div class="column" style="background-color:#bbb;">The current class is
        <div class="content">
            <p id=period></p>
        </div>
    </div>
</div>


<div class="footer">
    <p id=debug>Footer</p>
</div>

</body>
</html>