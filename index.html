<!DOCTYPE html>
<html>
<head>
<title>JPT Schedule</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
* {
    box-sizing: border-box;
}

body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: #26457a;
}

/* Style the header */
.header {
    color: #f1f1f1;
    padding: 15px;
    text-align: center;
    font-size: 35px;
}

/* Create three equal columns that floats next to each other */
.column {
    float: left;
    width: 50%;
    padding: 10px;
    font-size: 45px;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}

/* Style the footer */
.footer {
    background-color: #f1f1f1;
    padding: 10px;
    text-align: center;
}

.content {
    text-align: center;
    font-size: 90px;
    width: 300px;
    margin: auto;        
}

/* Responsive layout - makes the two columns stack on top of each other
instead of next to each other */
@media (max-width: 600px) {
    .column {
    width: 100%;
    }
}
</style>
</head>
<body>

<div class="header">
    <h2><img src="images/trojan.png" alt="Trojan logo" height="60"> Welcome to 
        Taravella!</h2>
</div>

<div class="row">
    <div class="column" style="background-color:#aaa;">Today is a(n)
        <div class="content">
            <p id=day></p>
        </div>
    </div>
    <div class="column" style="background-color:#bbb;">The current class is
        <div class="content">
            <p id=period></p>
        </div>
    </div>
</div>


<div class="footer">
    <p id=debug>Footer</p>
</div>


<script>
    const dayColor = 
    ["<b>A</b><br>Day", "<b>B</b><br>Day", "<b>A/B</b><br> Day", "Exam<br>Day", 
    "Day Off", "Thanksgiving", "Weekend", "Winter Break", "Spring Break"];
    const classPeriodA = 
        ["Good<br>Morning","1st<br>Period", "2nd<br>Period", "3rd<br>Period", 
        "4th<br>Period", "Good<br>Bye"];
    const classPeriodB = 
        ["Good<br>Morning", "5th<br>Period", "6th<br>Period", "7th<br>Period", 
        "8th<br>Period", "Good<br>Bye"];
    var currentPeriod = 0;
    const lunch = ["A Lunch", "B Lunch"];
    const earlyRelease = [62, 145, 180, 211, 239, 295];
    const PSD = [15, 50, 78, 106, 141, 169, 197, 232];
    const testing = [56];

    var updatePage = function() {
    // This is an array of the school year where day[0] is the first day of
    // school (8-18-21).
    const calendar = 
        [2,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,4,4,0,1,0,6,6,1,0,1,4,0,6,6,1,0,
        1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,4,1,0,6,6,1,0,1,
        0,1,6,6,0,1,0,1,0,6,6,1,0,1,4,0,6,6,1,0,1,0,1,6,6,5,5,5,5,5,6,6,0,1,0,1,
        0,6,6,1,0,1,0,1,6,6,0,3,3,3,3,6,6,7,7,7,7,7,7,7,7,7,7,7,7,6,6,1,0,1,0,1,
        6,6,0,4,1,0,1,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,
        6,1,0,1,0,1,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,4,6,6,
        8,8,8,8,8,6,6,4,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,4,6,6,1,0,1,0,1,6,6,0,
        1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,1,0,1,0,1,6,6,0,1,0,1,0,6,6,4,1,
        0,1,0,6,6,3,3,3,3];

    //Get current day
    var today = new Date();

    //Get the current minutes since midnight
    var minsToday = ((today.getMinutes()) + (today.getHours()) * 60);

    //Days since the first day of school
    var date1 = new Date("08/18/2021");
    var date2 = today;

    //Calculate the time difference of the two dates
    var differenceInTime = date2.getTime() - date1.getTime();
    
    // Calculate the no. of days between two dates
    var differenceInDays = Math.trunc(differenceInTime / (1000 * 3600 * 24));

    var aOrB = differenceInDays;

    //Display current day
    document.getElementById("day").innerHTML = dayColor[calendar[aOrB]];

    //Is it an Early Release or PSD?
    var isEarlyRelease = false;
    var isPSD = false;
    var isTesting = false;
    
    for (let i = 0; i < earlyRelease.length; i++){
        if (earlyRelease[i] == differenceInDays){
            isEarlyRelease = true;
        }
    };

    for (let i = 0; i < PSD.length; i++){
        if (PSD[i] == differenceInDays){
            isPSD = true;
        }
    };

    for (let i = 0; i < testing.length; i++){
        if (testing[i] == differenceInDays){
            isTesting = true;
        }
    };

    //Bell schedule (in minutes since midnight)
    //TODO make this a loop 
    if (isEarlyRelease){
        if (minsToday < 460){
            currentPeriod = 0;
        } else if (minsToday < 528){
            currentPeriod = 1;
        } else if (minsToday < 602){
            currentPeriod = 2;
        } else if (minsToday < 676){
            currentPeriod = 3; 
        } else if (minsToday < 750){
            currentPeriod = 4;
        } else {
            currentPeriod = 5;
        }
    } else if (isPSD){
        if (minsToday < 460){
            currentPeriod = 0;
        } else if (minsToday < 520){
            currentPeriod = 1;
        } else if (minsToday < 586){
            currentPeriod = 2;
        } else if (minsToday < 652){
            currentPeriod = 3;
        } else if (minsToday < 718){
            currentPeriod = 4;
        } else {
            currentPeriod = 5;
        }
    } else if (isTesting){
        if (minsToday < 460){
            currentPeriod = 0;
        } else if (minsToday < 475){
            currentPeriod = 1;
        } else if (minsToday < 715){
            currentPeriod = 2;
        } else if (minsToday < 790){
            currentPeriod = 3;
        } else if (minsToday < 835){
            currentPeriod = 4;
        } else {
            currentPeriod = 5;
        }        
    }
    else {
        if (minsToday < 460){
            currentPeriod = 0;
        } else if (minsToday < 556){
            currentPeriod = 1;
        } else if (minsToday < 653){
            currentPeriod = 2;
        } else if (minsToday < 783){
            currentPeriod = 3;
        } else if (minsToday < 880){
            currentPeriod = 4;
        } else {
            currentPeriod = 5;
        }
    }

    //Change periods for A or B day
    if (calendar[aOrB] < 1) {
        document.getElementById("period").innerHTML = 
            classPeriodA[currentPeriod];
    } else if (calendar[aOrB] < 2) {
        document.getElementById("period").innerHTML = 
            classPeriodB[currentPeriod];
    } else {
        //Replace content with "No School" message
        var content = dayColor[calendar[aOrB]];
        document.getElementsByTagName('style')[0].innerHTML = 
            "body {font-family: Arial, Helvetica, sans-serif; color: #f1f1f1; font-size: 80px; background-color: #1e1e1e; text-align: center; position: absolute; top: 50%; left: 50%; -ms-transform: translate(-50%, -50%); transform: translate(-50%, -50%);}";
        document.getElementsByTagName('body')[0].innerHTML = 
            "Enjoy Your " + content;
    }

    document.getElementById("debug").innerHTML = today;
    };

    window.setInterval(updatePage, 1000);
</script>
</body>
</html>